{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.207.0"},"children":{"BlogInfraStack":{"id":"BlogInfraStack","path":"BlogInfraStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.207.0"},"children":{"ImageTag":{"id":"ImageTag","path":"BlogInfraStack/ImageTag","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.207.0"}},"BlogUserPool":{"id":"BlogUserPool","path":"BlogInfraStack/BlogUserPool","constructInfo":{"fqn":"aws-cdk-lib.aws_cognito.UserPool","version":"2.207.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"BlogInfraStack/BlogUserPool/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cognito.CfnUserPool","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Cognito::UserPool","aws:cdk:cloudformation:props":{"accountRecoverySetting":{"recoveryMechanisms":[{"name":"verified_phone_number","priority":1},{"name":"verified_email","priority":2}]},"adminCreateUserConfig":{"allowAdminCreateUserOnly":false},"autoVerifiedAttributes":["email"],"emailVerificationMessage":"The verification code to your new account is {####}","emailVerificationSubject":"Verify your new account","policies":{"passwordPolicy":{"minimumLength":8,"requireLowercase":true,"requireUppercase":true,"requireNumbers":true,"requireSymbols":true}},"schema":[{"name":"email","mutable":true,"required":true}],"smsVerificationMessage":"The verification code to your new account is {####}","usernameAttributes":["email"],"userPoolName":"BlogUserPool-BlogInfraStack","verificationMessageTemplate":{"defaultEmailOption":"CONFIRM_WITH_CODE","emailMessage":"The verification code to your new account is {####}","emailSubject":"Verify your new account","smsMessage":"The verification code to your new account is {####}"}}}},"BlogAppClient":{"id":"BlogAppClient","path":"BlogInfraStack/BlogUserPool/BlogAppClient","constructInfo":{"fqn":"aws-cdk-lib.aws_cognito.UserPoolClient","version":"2.207.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"BlogInfraStack/BlogUserPool/BlogAppClient/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cognito.CfnUserPoolClient","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Cognito::UserPoolClient","aws:cdk:cloudformation:props":{"accessTokenValidity":1440,"allowedOAuthFlows":["implicit","code"],"allowedOAuthFlowsUserPoolClient":true,"allowedOAuthScopes":["profile","phone","email","openid","aws.cognito.signin.user.admin"],"callbackUrLs":["https://example.com"],"clientName":"WebAppClient","explicitAuthFlows":["ALLOW_USER_PASSWORD_AUTH","ALLOW_USER_SRP_AUTH","ALLOW_REFRESH_TOKEN_AUTH"],"generateSecret":false,"idTokenValidity":1440,"refreshTokenValidity":129600,"supportedIdentityProviders":["COGNITO"],"tokenValidityUnits":{"idToken":"minutes","accessToken":"minutes","refreshToken":"minutes"},"userPoolId":{"Ref":"BlogUserPoolBB1AE2CC"}}}}}}}},"BlogPostsTable":{"id":"BlogPostsTable","path":"BlogInfraStack/BlogPostsTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.207.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"BlogInfraStack/BlogPostsTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"PK","attributeType":"S"},{"attributeName":"SK","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"PK","keyType":"HASH"},{"attributeName":"SK","keyType":"RANGE"}],"tableName":"BlogPosts-BlogInfraStack"}}},"ScalingRole":{"id":"ScalingRole","path":"BlogInfraStack/BlogPostsTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.207.0","metadata":[]}}}},"BackendApiLambda":{"id":"BackendApiLambda","path":"BlogInfraStack/BackendApiLambda","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda_nodejs.NodejsFunction","version":"2.207.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"BlogInfraStack/BackendApiLambda/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.207.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"BlogInfraStack/BackendApiLambda/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.207.0","metadata":[]}},"Resource":{"id":"Resource","path":"BlogInfraStack/BackendApiLambda/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}],"tags":[{"key":"Purpose","value":"Application Logic"},{"key":"Tier","value":"Backend"}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"BlogInfraStack/BackendApiLambda/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.207.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"BlogInfraStack/BackendApiLambda/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["xray:PutTraceSegments","xray:PutTelemetryRecords"],"Effect":"Allow","Resource":"*"},{"Action":["dynamodb:BatchGetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["BlogPostsTable95467250","Arn"]},{"Ref":"AWS::NoValue"}]},{"Action":"dynamodb:Query","Effect":"Allow","Resource":{"Fn::Join":["",[{"Fn::GetAtt":["BlogPostsTable95467250","Arn"]},"/index/*"]]}},{"Action":["cognito-idp:SignUp","cognito-idp:InitiateAuth","cognito-idp:GlobalSignOut"],"Effect":"Allow","Resource":{"Fn::GetAtt":["BlogUserPoolBB1AE2CC","Arn"]}}],"Version":"2012-10-17"},"policyName":"BackendApiLambdaServiceRoleDefaultPolicyFB6B1772","roles":[{"Ref":"BackendApiLambdaServiceRoleED0D8CBE"}]}}}}}}},"Code":{"id":"Code","path":"BlogInfraStack/BackendApiLambda/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.207.0"},"children":{"Stage":{"id":"Stage","path":"BlogInfraStack/BackendApiLambda/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.207.0"}},"AssetBucket":{"id":"AssetBucket","path":"BlogInfraStack/BackendApiLambda/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.207.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"BlogInfraStack/BackendApiLambda/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-786382940028-ap-northeast-2","s3Key":"934b9777c0afc26aa24e8484bd7bdcbca4f72a31d955f899e5ff4de39732d741.zip"},"description":"Handles all backend API logic (CRUD, Auth, etc.) via Hono.","environment":{"variables":{"NODE_ENV":"production","TABLE_NAME":{"Ref":"BlogPostsTable95467250"},"USER_POOL_ID":{"Ref":"BlogUserPoolBB1AE2CC"},"USER_POOL_CLIENT_ID":{"Ref":"BlogUserPoolBlogAppClientFC769CAF"},"REGION":"ap-northeast-2","AWS_NODEJS_CONNECTION_REUSE_ENABLED":"1"}},"functionName":"blog-backend-api-BlogInfraStack","handler":"index.handler","memorySize":256,"role":{"Fn::GetAtt":["BackendApiLambdaServiceRoleED0D8CBE","Arn"]},"runtime":"nodejs22.x","tags":[{"key":"Purpose","value":"Application Logic"},{"key":"Tier","value":"Backend"}],"timeout":30,"tracingConfig":{"mode":"Active"}}}}}},"BlogHttpApiGateway":{"id":"BlogHttpApiGateway","path":"BlogInfraStack/BlogHttpApiGateway","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpApi","version":"2.207.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"BlogInfraStack/BlogHttpApiGateway/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnApi","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Api","aws:cdk:cloudformation:props":{"corsConfiguration":{"allowCredentials":true,"allowHeaders":["Content-Type","Authorization"],"allowMethods":["GET","POST","PUT","DELETE","OPTIONS"],"allowOrigins":["http://localhost:3000","https://blog.jungyu.store"]},"name":"BlogHttpApi-BlogInfraStack","protocolType":"HTTP"}}},"DefaultStage":{"id":"DefaultStage","path":"BlogInfraStack/BlogHttpApiGateway/DefaultStage","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpStage","version":"2.207.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"BlogInfraStack/BlogHttpApiGateway/DefaultStage/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnStage","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Stage","aws:cdk:cloudformation:props":{"apiId":{"Ref":"BlogHttpApiGatewayCD53D1DC"},"autoDeploy":true,"stageName":"$default"}}}}},"ANY--{proxy+}":{"id":"ANY--{proxy+}","path":"BlogInfraStack/BlogHttpApiGateway/ANY--{proxy+}","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpRoute","version":"2.207.0","metadata":[]},"children":{"LambdaIntegration":{"id":"LambdaIntegration","path":"BlogInfraStack/BlogHttpApiGateway/ANY--{proxy+}/LambdaIntegration","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpIntegration","version":"2.207.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"BlogInfraStack/BlogHttpApiGateway/ANY--{proxy+}/LambdaIntegration/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnIntegration","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Integration","aws:cdk:cloudformation:props":{"apiId":{"Ref":"BlogHttpApiGatewayCD53D1DC"},"integrationType":"AWS_PROXY","integrationUri":{"Fn::GetAtt":["BackendApiLambda22D4E71D","Arn"]},"payloadFormatVersion":"2.0"}}}}},"LambdaIntegration-Permission":{"id":"LambdaIntegration-Permission","path":"BlogInfraStack/BlogHttpApiGateway/ANY--{proxy+}/LambdaIntegration-Permission","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["BackendApiLambda22D4E71D","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":execute-api:ap-northeast-2:786382940028:",{"Ref":"BlogHttpApiGatewayCD53D1DC"},"/*/*/{proxy+}"]]}}}},"Resource":{"id":"Resource","path":"BlogInfraStack/BlogHttpApiGateway/ANY--{proxy+}/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"BlogHttpApiGatewayCD53D1DC"},"authorizationType":"NONE","routeKey":"ANY /{proxy+}","target":{"Fn::Join":["",["integrations/",{"Ref":"BlogHttpApiGatewayANYproxyLambdaIntegration98027455"}]]}}}}}}}},"HostedZone":{"id":"HostedZone","path":"BlogInfraStack/HostedZone","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.207.0","metadata":[]}},"SiteCertificate":{"id":"SiteCertificate","path":"BlogInfraStack/SiteCertificate","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.207.0","metadata":[]}},"FrontendAssetsBucket":{"id":"FrontendAssetsBucket","path":"BlogInfraStack/FrontendAssetsBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.207.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"BlogInfraStack/FrontendAssetsBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"ownershipControls":{"rules":[{"objectOwnership":"BucketOwnerEnforced"}]},"publicAccessBlockConfiguration":{"blockPublicAcls":true,"blockPublicPolicy":true,"ignorePublicAcls":true,"restrictPublicBuckets":true},"tags":[{"key":"aws-cdk:auto-delete-objects","value":"true"}]}}},"Policy":{"id":"Policy","path":"BlogInfraStack/FrontendAssetsBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.207.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"BlogInfraStack/FrontendAssetsBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"FrontendAssetsBucket52F4AD30"},"policyDocument":{"Statement":[{"Action":["s3:PutBucketPolicy","s3:GetBucket*","s3:List*","s3:DeleteObject*"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092","Arn"]}},"Resource":[{"Fn::GetAtt":["FrontendAssetsBucket52F4AD30","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["FrontendAssetsBucket52F4AD30","Arn"]},"/*"]]}]},{"Action":"s3:GetObject","Condition":{"StringEquals":{"AWS:SourceArn":{"Fn::Join":["",["arn:aws:cloudfront::786382940028:distribution/",{"Ref":"NewFrontendDistribution"}]]},"AWS:SourceAccount":"786382940028"}},"Effect":"Allow","Principal":{"Service":"cloudfront.amazonaws.com"},"Resource":{"Fn::Join":["",[{"Fn::GetAtt":["FrontendAssetsBucket52F4AD30","Arn"]},"/*"]]}}],"Version":"2012-10-17"}}}}}},"AutoDeleteObjectsCustomResource":{"id":"AutoDeleteObjectsCustomResource","path":"BlogInfraStack/FrontendAssetsBucket/AutoDeleteObjectsCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.207.0","metadata":[]},"children":{"Default":{"id":"Default","path":"BlogInfraStack/FrontendAssetsBucket/AutoDeleteObjectsCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.207.0"}}}}}},"Custom::S3AutoDeleteObjectsCustomResourceProvider":{"id":"Custom::S3AutoDeleteObjectsCustomResourceProvider","path":"BlogInfraStack/Custom::S3AutoDeleteObjectsCustomResourceProvider","constructInfo":{"fqn":"aws-cdk-lib.CustomResourceProviderBase","version":"2.207.0"},"children":{"Staging":{"id":"Staging","path":"BlogInfraStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Staging","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.207.0"}},"Role":{"id":"Role","path":"BlogInfraStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Role","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.207.0"}},"Handler":{"id":"Handler","path":"BlogInfraStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.207.0"}}}},"FrontendEcrRepo":{"id":"FrontendEcrRepo","path":"BlogInfraStack/FrontendEcrRepo","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.RepositoryBase","version":"2.207.0","metadata":[]}},"FrontendServerLambda":{"id":"FrontendServerLambda","path":"BlogInfraStack/FrontendServerLambda","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.DockerImageFunction","version":"2.207.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"BlogInfraStack/FrontendServerLambda/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.207.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"BlogInfraStack/FrontendServerLambda/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.207.0","metadata":[]}},"Resource":{"id":"Resource","path":"BlogInfraStack/FrontendServerLambda/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}],"tags":[{"key":"Purpose","value":"Application Logic"},{"key":"Tier","value":"Frontend"}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"BlogInfraStack/FrontendServerLambda/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.207.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"BlogInfraStack/FrontendServerLambda/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["FrontendAssetsBucket52F4AD30","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["FrontendAssetsBucket52F4AD30","Arn"]},"/*"]]}]}],"Version":"2012-10-17"},"policyName":"FrontendServerLambdaServiceRoleDefaultPolicy691C032A","roles":[{"Ref":"FrontendServerLambdaServiceRole1087CF04"}]}}}}}}},"Resource":{"id":"Resource","path":"BlogInfraStack/FrontendServerLambda/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"architectures":["arm64"],"code":{"imageUri":{"Fn::Join":["",["786382940028.dkr.ecr.ap-northeast-2.",{"Ref":"AWS::URLSuffix"},"/new-blog-frontend:",{"Ref":"ImageTag"}]]}},"description":"Renders the Next.js frontend application (SSR).","environment":{"variables":{"AWS_LAMBDA_EXEC_WRAPPER":"/opt/extensions/lambda-adapter","PORT":"3000","NEXT_PUBLIC_API_ENDPOINT":{"Fn::Join":["",["https://",{"Ref":"BlogHttpApiGatewayCD53D1DC"},".execute-api.ap-northeast-2.",{"Ref":"AWS::URLSuffix"},"/"]]},"NEXT_PUBLIC_REGION":"ap-northeast-2","NEXT_PUBLIC_USER_POOL_ID":{"Ref":"BlogUserPoolBB1AE2CC"},"NEXT_PUBLIC_USER_POOL_CLIENT_ID":{"Ref":"BlogUserPoolBlogAppClientFC769CAF"}}},"functionName":"blog-frontend-server-BlogInfraStack","memorySize":1024,"packageType":"Image","role":{"Fn::GetAtt":["FrontendServerLambdaServiceRole1087CF04","Arn"]},"tags":[{"key":"Purpose","value":"Application Logic"},{"key":"Tier","value":"Frontend"}],"timeout":30}}},"FunctionUrl":{"id":"FunctionUrl","path":"BlogInfraStack/FrontendServerLambda/FunctionUrl","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.FunctionUrl","version":"2.207.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"BlogInfraStack/FrontendServerLambda/FunctionUrl/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnUrl","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Url","aws:cdk:cloudformation:props":{"authType":"NONE","targetFunctionArn":{"Fn::GetAtt":["FrontendServerLambdaDC0C127D","Arn"]}}}}}},"invoke-function-url":{"id":"invoke-function-url","path":"BlogInfraStack/FrontendServerLambda/invoke-function-url","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunctionUrl","functionName":{"Fn::GetAtt":["FrontendServerLambdaDC0C127D","Arn"]},"functionUrlAuthType":"NONE","principal":"*"}}}}},"S3OAC":{"id":"S3OAC","path":"BlogInfraStack/S3OAC","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.CfnOriginAccessControl","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudFront::OriginAccessControl","aws:cdk:cloudformation:props":{"originAccessControlConfig":{"name":"OAC-for-S3-BlogInfraStack","originAccessControlOriginType":"s3","signingBehavior":"always","signingProtocol":"sigv4"}}}},"NewFrontendDistribution":{"id":"NewFrontendDistribution","path":"BlogInfraStack/NewFrontendDistribution","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.CfnDistribution","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudFront::Distribution","aws:cdk:cloudformation:props":{"distributionConfig":{"comment":"Distribution for blog.jungyu.store","enabled":true,"httpVersion":"http2","priceClass":"PriceClass_200","aliases":["blog.jungyu.store"],"viewerCertificate":{"acmCertificateArn":"arn:aws:acm:us-east-1:786382940028:certificate/d8aa46d8-b8dc-4d1b-b590-c5d4a52b7081","sslSupportMethod":"sni-only","minimumProtocolVersion":"TLSv1.2_2021"},"origins":[{"id":"FrontendServerOrigin","domainName":{"Fn::Select":[2,{"Fn::Split":["/",{"Fn::GetAtt":["FrontendServerLambdaFunctionUrl0E7F662D","FunctionUrl"]}]}]},"customOriginConfig":{"originProtocolPolicy":"https-only","originSslProtocols":["TLSv1.2"]}},{"id":"FrontendAssetsOrigin","domainName":{"Fn::GetAtt":["FrontendAssetsBucket52F4AD30","RegionalDomainName"]},"originAccessControlId":{"Fn::GetAtt":["S3OAC","Id"]},"s3OriginConfig":{}},{"id":"BackendApiOrigin","domainName":{"Fn::Select":[0,{"Fn::Split":["/",{"Fn::Select":[1,{"Fn::Split":["://",{"Fn::Join":["",["https://",{"Ref":"BlogHttpApiGatewayCD53D1DC"},".execute-api.ap-northeast-2.",{"Ref":"AWS::URLSuffix"},"/"]]}]}]}]}]},"customOriginConfig":{"originProtocolPolicy":"https-only","originSslProtocols":["TLSv1.2"]}}],"defaultCacheBehavior":{"targetOriginId":"FrontendServerOrigin","viewerProtocolPolicy":"redirect-to-https","allowedMethods":["GET","HEAD","OPTIONS","PUT","POST","PATCH","DELETE"],"cachedMethods":["GET","HEAD"],"cachePolicyId":"4135ea2d-6df8-44a3-9df3-4b5a84be39ad","originRequestPolicyId":"b689b0a8-53d0-40ab-baf2-68738e2966ac"},"cacheBehaviors":[{"pathPattern":"/_next/static/*","targetOriginId":"FrontendAssetsOrigin","viewerProtocolPolicy":"redirect-to-https","cachePolicyId":"658327ea-f89d-4fab-a63d-7e88639e58f6","compress":true},{"pathPattern":"/assets/*","targetOriginId":"FrontendAssetsOrigin","viewerProtocolPolicy":"redirect-to-https","cachePolicyId":"658327ea-f89d-4fab-a63d-7e88639e58f6","compress":true},{"pathPattern":"/api/*","targetOriginId":"BackendApiOrigin","viewerProtocolPolicy":"redirect-to-https","allowedMethods":["GET","HEAD","OPTIONS","PUT","POST","PATCH","DELETE"],"cachePolicyId":"4135ea2d-6df8-44a3-9df3-4b5a84be39ad","originRequestPolicyId":"b689b0a8-53d0-40ab-baf2-68738e2966ac"}]}}}},"ImportedDistribution":{"id":"ImportedDistribution","path":"BlogInfraStack/ImportedDistribution","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.207.0","metadata":[]}},"NewSiteARecord":{"id":"NewSiteARecord","path":"BlogInfraStack/NewSiteARecord","constructInfo":{"fqn":"aws-cdk-lib.aws_route53.ARecord","version":"2.207.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"BlogInfraStack/NewSiteARecord/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_route53.CfnRecordSet","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Route53::RecordSet","aws:cdk:cloudformation:props":{"aliasTarget":{"hostedZoneId":{"Fn::FindInMap":["AWSCloudFrontPartitionHostedZoneIdMap",{"Ref":"AWS::Partition"},"zoneId"]},"dnsName":{"Fn::GetAtt":["NewFrontendDistribution","DomainName"]}},"hostedZoneId":"Z0802600EUJ1KX823IZ7","name":"blog.jungyu.store.","type":"A"}}}}},"AWSCloudFrontPartitionHostedZoneIdMap":{"id":"AWSCloudFrontPartitionHostedZoneIdMap","path":"BlogInfraStack/AWSCloudFrontPartitionHostedZoneIdMap","constructInfo":{"fqn":"aws-cdk-lib.CfnMapping","version":"2.207.0"}},"ApiGatewayEndpoint":{"id":"ApiGatewayEndpoint","path":"BlogInfraStack/ApiGatewayEndpoint","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.207.0"}},"UserPoolIdOutput":{"id":"UserPoolIdOutput","path":"BlogInfraStack/UserPoolIdOutput","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.207.0"}},"UserPoolClientIdOutput":{"id":"UserPoolClientIdOutput","path":"BlogInfraStack/UserPoolClientIdOutput","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.207.0"}},"RegionOutput":{"id":"RegionOutput","path":"BlogInfraStack/RegionOutput","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.207.0"}},"FrontendURL":{"id":"FrontendURL","path":"BlogInfraStack/FrontendURL","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.207.0"}},"FrontendAssetsBucketName":{"id":"FrontendAssetsBucketName","path":"BlogInfraStack/FrontendAssetsBucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.207.0"}},"CloudFrontDistributionId":{"id":"CloudFrontDistributionId","path":"BlogInfraStack/CloudFrontDistributionId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.207.0"}},"BackendApiLambdaErrorsAlarm":{"id":"BackendApiLambdaErrorsAlarm","path":"BlogInfraStack/BackendApiLambdaErrorsAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.207.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"BlogInfraStack/BackendApiLambdaErrorsAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmDescription":"Lambda function errors detected!","comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"FunctionName","value":{"Ref":"BackendApiLambda22D4E71D"}}],"evaluationPeriods":1,"metricName":"Errors","namespace":"AWS/Lambda","period":300,"statistic":"Sum","threshold":1}}}}},"ApiGatewayServerErrorAlarm":{"id":"ApiGatewayServerErrorAlarm","path":"BlogInfraStack/ApiGatewayServerErrorAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.207.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"BlogInfraStack/ApiGatewayServerErrorAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmDescription":"API Gateway 5xx server errors detected!","comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"ApiId","value":{"Ref":"BlogHttpApiGatewayCD53D1DC"}}],"evaluationPeriods":1,"metricName":"5xx","namespace":"AWS/ApiGateway","period":300,"statistic":"Sum","threshold":1}}}}},"CDKMetadata":{"id":"CDKMetadata","path":"BlogInfraStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"BlogInfraStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.207.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"BlogInfraStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.207.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"BlogInfraStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.207.0"}}}},"CiCdStack":{"id":"CiCdStack","path":"CiCdStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.207.0"},"children":{"DefaultVpc":{"id":"DefaultVpc","path":"CiCdStack/DefaultVpc","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.207.0","metadata":[]},"children":{"PublicSubnet1":{"id":"PublicSubnet1","path":"CiCdStack/DefaultVpc/PublicSubnet1","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.207.0","metadata":[]}},"PublicSubnet2":{"id":"PublicSubnet2","path":"CiCdStack/DefaultVpc/PublicSubnet2","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.207.0","metadata":[]}},"PublicSubnet3":{"id":"PublicSubnet3","path":"CiCdStack/DefaultVpc/PublicSubnet3","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.207.0","metadata":[]}},"PublicSubnet4":{"id":"PublicSubnet4","path":"CiCdStack/DefaultVpc/PublicSubnet4","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.207.0","metadata":[]}},"SecretsManagerEndpoint":{"id":"SecretsManagerEndpoint","path":"CiCdStack/DefaultVpc/SecretsManagerEndpoint","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.InterfaceVpcEndpoint","version":"2.207.0","metadata":[]},"children":{"SecurityGroup":{"id":"SecurityGroup","path":"CiCdStack/DefaultVpc/SecretsManagerEndpoint/SecurityGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.207.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"CiCdStack/DefaultVpc/SecretsManagerEndpoint/SecurityGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"CiCdStack/DefaultVpc/SecretsManagerEndpoint/SecurityGroup","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"securityGroupIngress":[{"cidrIp":"172.31.0.0/16","ipProtocol":"tcp","fromPort":443,"toPort":443,"description":"from 172.31.0.0/16:443"}],"vpcId":"vpc-09064aa8dcdebfc42"}}},"from CiCdStackRunnerSecurityGroupE2519603:443":{"id":"from CiCdStackRunnerSecurityGroupE2519603:443","path":"CiCdStack/DefaultVpc/SecretsManagerEndpoint/SecurityGroup/from CiCdStackRunnerSecurityGroupE2519603:443","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroupIngress","aws:cdk:cloudformation:props":{"description":"from CiCdStackRunnerSecurityGroupE2519603:443","fromPort":443,"groupId":{"Fn::GetAtt":["DefaultVpcSecretsManagerEndpointSecurityGroupE273AA4E","GroupId"]},"ipProtocol":"tcp","sourceSecurityGroupId":{"Fn::GetAtt":["RunnerSecurityGroupDE989EBE","GroupId"]},"toPort":443}}}}},"Resource":{"id":"Resource","path":"CiCdStack/DefaultVpc/SecretsManagerEndpoint/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPCEndpoint","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPCEndpoint","aws:cdk:cloudformation:props":{"privateDnsEnabled":true,"securityGroupIds":[{"Fn::GetAtt":["DefaultVpcSecretsManagerEndpointSecurityGroupE273AA4E","GroupId"]}],"serviceName":"com.amazonaws.ap-northeast-2.secretsmanager","subnetIds":["subnet-0ccc097504af25410","subnet-0096ce9f9bb4494d5","subnet-0080dfc4df4676ff0","subnet-0682caf8cc8bb77d3"],"vpcEndpointType":"Interface","vpcId":"vpc-09064aa8dcdebfc42"}}}}}}},"RunnerSecurityGroup":{"id":"RunnerSecurityGroup","path":"CiCdStack/RunnerSecurityGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.207.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"CiCdStack/RunnerSecurityGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"Security group for the EC2 self-hosted runner","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"vpcId":"vpc-09064aa8dcdebfc42"}}}}},"RunnerRole":{"id":"RunnerRole","path":"CiCdStack/RunnerRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.207.0","metadata":[]},"children":{"ImportRunnerRole":{"id":"ImportRunnerRole","path":"CiCdStack/RunnerRole/ImportRunnerRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.207.0","metadata":[]}},"Resource":{"id":"Resource","path":"CiCdStack/RunnerRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ec2.amazonaws.com"}}],"Version":"2012-10-17"},"description":"IAM Role for the self-hosted runner EC2 instance","managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonSSMManagedInstanceCore"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AdministratorAccess"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"CiCdStack/RunnerRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.207.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"CiCdStack/RunnerRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["secretsmanager:GetSecretValue","secretsmanager:DescribeSecret"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":secretsmanager:ap-northeast-2:786382940028:secret:cicd/github-runner-pat-??????"]]}}],"Version":"2012-10-17"},"policyName":"RunnerRoleDefaultPolicyF88A4DBD","roles":[{"Ref":"RunnerRoleBA0605C0"}]}}}}}}},"GitHubPatSecret":{"id":"GitHubPatSecret","path":"CiCdStack/GitHubPatSecret","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.207.0","metadata":[]}},"GitHubRunnerInstance":{"id":"GitHubRunnerInstance","path":"CiCdStack/GitHubRunnerInstance","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.Instance","version":"2.207.0","metadata":[]},"children":{"InstanceProfile":{"id":"InstanceProfile","path":"CiCdStack/GitHubRunnerInstance/InstanceProfile","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnInstanceProfile","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::InstanceProfile","aws:cdk:cloudformation:props":{"roles":[{"Ref":"RunnerRoleBA0605C0"}]}}},"Resource":{"id":"Resource","path":"CiCdStack/GitHubRunnerInstance/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnInstance","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Instance","aws:cdk:cloudformation:props":{"availabilityZone":"ap-northeast-2a","blockDeviceMappings":[{"deviceName":"/dev/xvda","ebs":{"deleteOnTermination":true,"volumeSize":30,"volumeType":"gp3"}}],"iamInstanceProfile":{"Ref":"GitHubRunnerInstanceInstanceProfileF9DDF1ED"},"imageId":"ami-07180ab354582638a","instanceType":"t4g.small","securityGroupIds":[{"Fn::GetAtt":["RunnerSecurityGroupDE989EBE","GroupId"]}],"subnetId":"subnet-0ccc097504af25410","tags":[{"key":"Name","value":"CiCdStack/GitHubRunnerInstance"}],"userData":{"Fn::Base64":"#!/bin/bash\n#!/bin/bash\ndnf update -y\ndnf install -y git jq docker\nsystemctl enable --now docker\nusermod -aG docker ec2-user\nsu - ec2-user <<'EOF'\n  # GitHub 리포지토리를 클론합니다.\n  git clone https://github.com/jungyuya/new-blog.git\n  cd new-blog\n  \n  # 설치 스크립트에 실행 권한을 부여하고 실행합니다.\n  chmod +x ./scripts/setup_runner.sh\n  ./scripts/setup_runner.sh\nEOF"}}}}}},"RunnerEIP":{"id":"RunnerEIP","path":"CiCdStack/RunnerEIP","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnEIP","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::EIP","aws:cdk:cloudformation:props":{}}},"RunnerEIPAssociation":{"id":"RunnerEIPAssociation","path":"CiCdStack/RunnerEIPAssociation","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnEIPAssociation","version":"2.207.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::EIPAssociation","aws:cdk:cloudformation:props":{"eip":{"Ref":"RunnerEIP"},"instanceId":{"Ref":"GitHubRunnerInstance6965C09B"}}}},"RunnerPublicIP":{"id":"RunnerPublicIP","path":"CiCdStack/RunnerPublicIP","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.207.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"CiCdStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"CiCdStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.207.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"CiCdStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.207.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"CiCdStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.207.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}