"use strict";var Je=Object.create;var q=Object.defineProperty;var Le=Object.getOwnPropertyDescriptor;var Ve=Object.getOwnPropertyNames;var ke=Object.getPrototypeOf,Fe=Object.prototype.hasOwnProperty;var f=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),$e=(e,t)=>{for(var r in t)q(e,r,{get:t[r],enumerable:!0})},ue=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Ve(t))!Fe.call(e,i)&&i!==r&&q(e,i,{get:()=>t[i],enumerable:!(n=Le(t,i))||n.enumerable});return e};var Ke=(e,t,r)=>(r=e!=null?Je(ke(e)):{},ue(t||!e||!e.__esModule?q(r,"default",{value:e,enumerable:!0}):r,e)),We=e=>ue(q({},"__esModule",{value:!0}),e);var fe=f(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.default="ffffffff-ffff-ffff-ffff-ffffffffffff"});var de=f(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.default="00000000-0000-0000-0000-000000000000"});var le=f(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});k.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i});var b=f(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});var ze=le();function Ge(e){return typeof e=="string"&&ze.default.test(e)}F.default=Ge});var P=f($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});var He=b();function Xe(e){if(!(0,He.default)(e))throw TypeError("Invalid UUID");let t;return Uint8Array.of((t=parseInt(e.slice(0,8),16))>>>24,t>>>16&255,t>>>8&255,t&255,(t=parseInt(e.slice(9,13),16))>>>8,t&255,(t=parseInt(e.slice(14,18),16))>>>8,t&255,(t=parseInt(e.slice(19,23),16))>>>8,t&255,(t=parseInt(e.slice(24,36),16))/1099511627776&255,t/4294967296&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255)}$.default=Xe});var j=f(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});C.unsafeStringify=void 0;var Ye=b(),l=[];for(let e=0;e<256;++e)l.push((e+256).toString(16).slice(1));function ce(e,t=0){return(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase()}C.unsafeStringify=ce;function Qe(e,t=0){let r=ce(e,t);if(!(0,Ye.default)(r))throw TypeError("Stringified UUID is invalid");return r}C.default=Qe});var E=f(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});var Ze=require("crypto"),D=new Uint8Array(256),A=D.length;function Be(){return A>D.length-16&&((0,Ze.randomFillSync)(D),A=0),D.slice(A,A+=16)}K.default=Be});var W=f(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.updateV1State=void 0;var pe=E(),et=j(),T={};function tt(e,t,r){let n,i=e?._v6??!1;if(e){let o=Object.keys(e);o.length===1&&o[0]==="_v6"&&(e=void 0)}if(e)n=ge(e.random??e.rng?.()??(0,pe.default)(),e.msecs,e.nsecs,e.clockseq,e.node,t,r);else{let o=Date.now(),a=(0,pe.default)();ye(T,o,a),n=ge(a,T.msecs,T.nsecs,i?void 0:T.clockseq,i?void 0:T.node,t,r)}return t??(0,et.unsafeStringify)(n)}function ye(e,t,r){return e.msecs??=-1/0,e.nsecs??=0,t===e.msecs?(e.nsecs++,e.nsecs>=1e4&&(e.node=void 0,e.nsecs=0)):t>e.msecs?e.nsecs=0:t<e.msecs&&(e.node=void 0),e.node||(e.node=r.slice(10,16),e.node[0]|=1,e.clockseq=(r[8]<<8|r[9])&16383),e.msecs=t,e}U.updateV1State=ye;function ge(e,t,r,n,i,o,a=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(!o)o=new Uint8Array(16),a=0;else if(a<0||a+16>o.length)throw new RangeError(`UUID byte range ${a}:${a+15} is out of buffer bounds`);t??=Date.now(),r??=0,n??=(e[8]<<8|e[9])&16383,i??=e.slice(10,16),t+=122192928e5;let y=((t&268435455)*1e4+r)%4294967296;o[a++]=y>>>24&255,o[a++]=y>>>16&255,o[a++]=y>>>8&255,o[a++]=y&255;let d=t/4294967296*1e4&268435455;o[a++]=d>>>8&255,o[a++]=d&255,o[a++]=d>>>24&15|16,o[a++]=d>>>16&255,o[a++]=n>>>8|128,o[a++]=n&255;for(let _=0;_<6;++_)o[a++]=i[_];return o}U.default=tt});var G=f(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});var rt=P(),nt=j();function it(e){let t=typeof e=="string"?(0,rt.default)(e):e,r=ot(t);return typeof e=="string"?(0,nt.unsafeStringify)(r):r}z.default=it;function ot(e){return Uint8Array.of((e[6]&15)<<4|e[7]>>4&15,(e[7]&15)<<4|(e[4]&240)>>4,(e[4]&15)<<4|(e[5]&240)>>4,(e[5]&15)<<4|(e[0]&240)>>4,(e[0]&15)<<4|(e[1]&240)>>4,(e[1]&15)<<4|(e[2]&240)>>4,96|e[2]&15,e[3],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}});var _e=f(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});var st=require("crypto");function at(e){return Array.isArray(e)?e=Buffer.from(e):typeof e=="string"&&(e=Buffer.from(e,"utf8")),(0,st.createHash)("md5").update(e).digest()}H.default=at});var I=f(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0});h.URL=h.DNS=h.stringToBytes=void 0;var me=P(),ut=j();function xe(e){e=unescape(encodeURIComponent(e));let t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t[r]=e.charCodeAt(r);return t}h.stringToBytes=xe;h.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8";h.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function ft(e,t,r,n,i,o){let a=typeof r=="string"?xe(r):r,y=typeof n=="string"?(0,me.default)(n):n;if(typeof n=="string"&&(n=(0,me.default)(n)),n?.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let d=new Uint8Array(16+a.length);if(d.set(y),d.set(a,y.length),d=t(d),d[6]=d[6]&15|e,d[8]=d[8]&63|128,i){o=o||0;for(let _=0;_<16;++_)i[o+_]=d[_];return i}return(0,ut.unsafeStringify)(d)}h.default=ft});var he=f(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});O.URL=O.DNS=void 0;var dt=_e(),X=I(),je=I();Object.defineProperty(O,"DNS",{enumerable:!0,get:function(){return je.DNS}});Object.defineProperty(O,"URL",{enumerable:!0,get:function(){return je.URL}});function Y(e,t,r,n){return(0,X.default)(48,dt.default,e,t,r,n)}Y.DNS=X.DNS;Y.URL=X.URL;O.default=Y});var Oe=f(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});var lt=require("crypto");Q.default={randomUUID:lt.randomUUID}});var ve=f(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});var Se=Oe(),ct=E(),pt=j();function gt(e,t,r){if(Se.default.randomUUID&&!t&&!e)return Se.default.randomUUID();e=e||{};let n=e.random??e.rng?.()??(0,ct.default)();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){if(r=r||0,r<0||r+16>t.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let i=0;i<16;++i)t[r+i]=n[i];return t}return(0,pt.unsafeStringify)(n)}Z.default=gt});var be=f(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});var yt=require("crypto");function _t(e){return Array.isArray(e)?e=Buffer.from(e):typeof e=="string"&&(e=Buffer.from(e,"utf8")),(0,yt.createHash)("sha1").update(e).digest()}B.default=_t});var Ce=f(S=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0});S.URL=S.DNS=void 0;var mt=be(),ee=I(),Pe=I();Object.defineProperty(S,"DNS",{enumerable:!0,get:function(){return Pe.DNS}});Object.defineProperty(S,"URL",{enumerable:!0,get:function(){return Pe.URL}});function te(e,t,r,n){return(0,ee.default)(80,mt.default,e,t,r,n)}te.DNS=ee.DNS;te.URL=ee.URL;S.default=te});var Te=f(re=>{"use strict";Object.defineProperty(re,"__esModule",{value:!0});var xt=j(),jt=W(),ht=G();function Ot(e,t,r){e??={},r??=0;let n=(0,jt.default)({...e,_v6:!0},new Uint8Array(16));if(n=(0,ht.default)(n),t){for(let i=0;i<16;i++)t[r+i]=n[i];return t}return(0,xt.unsafeStringify)(n)}re.default=Ot});var Ue=f(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});var St=P(),vt=j();function bt(e){let t=typeof e=="string"?(0,St.default)(e):e,r=Pt(t);return typeof e=="string"?(0,vt.unsafeStringify)(r):r}ne.default=bt;function Pt(e){return Uint8Array.of((e[3]&15)<<4|e[4]>>4&15,(e[4]&15)<<4|(e[5]&240)>>4,(e[5]&15)<<4|e[6]&15,e[7],(e[1]&15)<<4|(e[2]&240)>>4,(e[2]&15)<<4|(e[3]&240)>>4,16|(e[0]&240)>>4,(e[0]&15)<<4|(e[1]&240)>>4,e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}});var qe=f(w=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0});w.updateV7State=void 0;var Ie=E(),Ct=j(),ie={};function Tt(e,t,r){let n;if(e)n=we(e.random??e.rng?.()??(0,Ie.default)(),e.msecs,e.seq,t,r);else{let i=Date.now(),o=(0,Ie.default)();Ne(ie,i,o),n=we(o,ie.msecs,ie.seq,t,r)}return t??(0,Ct.unsafeStringify)(n)}function Ne(e,t,r){return e.msecs??=-1/0,e.seq??=0,t>e.msecs?(e.seq=r[6]<<23|r[7]<<16|r[8]<<8|r[9],e.msecs=t):(e.seq=e.seq+1|0,e.seq===0&&e.msecs++),e}w.updateV7State=Ne;function we(e,t,r,n,i=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(!n)n=new Uint8Array(16),i=0;else if(i<0||i+16>n.length)throw new RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`);return t??=Date.now(),r??=e[6]*127<<24|e[7]<<16|e[8]<<8|e[9],n[i++]=t/1099511627776&255,n[i++]=t/4294967296&255,n[i++]=t/16777216&255,n[i++]=t/65536&255,n[i++]=t/256&255,n[i++]=t&255,n[i++]=112|r>>>28&15,n[i++]=r>>>20&255,n[i++]=128|r>>>14&63,n[i++]=r>>>6&255,n[i++]=r<<2&255|e[10]&3,n[i++]=e[11],n[i++]=e[12],n[i++]=e[13],n[i++]=e[14],n[i++]=e[15],n}w.default=Tt});var Ae=f(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});var Ut=b();function It(e){if(!(0,Ut.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}oe.default=It});var De=f(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0});s.version=s.validate=s.v7=s.v6ToV1=s.v6=s.v5=s.v4=s.v3=s.v1ToV6=s.v1=s.stringify=s.parse=s.NIL=s.MAX=void 0;var wt=fe();Object.defineProperty(s,"MAX",{enumerable:!0,get:function(){return wt.default}});var Nt=de();Object.defineProperty(s,"NIL",{enumerable:!0,get:function(){return Nt.default}});var qt=P();Object.defineProperty(s,"parse",{enumerable:!0,get:function(){return qt.default}});var At=j();Object.defineProperty(s,"stringify",{enumerable:!0,get:function(){return At.default}});var Dt=W();Object.defineProperty(s,"v1",{enumerable:!0,get:function(){return Dt.default}});var Et=G();Object.defineProperty(s,"v1ToV6",{enumerable:!0,get:function(){return Et.default}});var Rt=he();Object.defineProperty(s,"v3",{enumerable:!0,get:function(){return Rt.default}});var Mt=ve();Object.defineProperty(s,"v4",{enumerable:!0,get:function(){return Mt.default}});var Jt=Ce();Object.defineProperty(s,"v5",{enumerable:!0,get:function(){return Jt.default}});var Lt=Te();Object.defineProperty(s,"v6",{enumerable:!0,get:function(){return Lt.default}});var Vt=Ue();Object.defineProperty(s,"v6ToV1",{enumerable:!0,get:function(){return Vt.default}});var kt=qe();Object.defineProperty(s,"v7",{enumerable:!0,get:function(){return kt.default}});var Ft=b();Object.defineProperty(s,"validate",{enumerable:!0,get:function(){return Ft.default}});var $t=Ae();Object.defineProperty(s,"version",{enumerable:!0,get:function(){return $t.default}})});var zt={};$e(zt,{handler:()=>Wt});module.exports=We(zt);var R=require("@aws-sdk/client-dynamodb"),g=require("@aws-sdk/lib-dynamodb"),m=require("@aws-sdk/client-cognito-identity-provider"),Ee=Ke(De()),Kt=new R.DynamoDBClient({}),v=new(require("@aws-sdk/lib-dynamodb")).DynamoDBDocumentClient(Kt),se=new m.CognitoIdentityProviderClient({}),Wt=async e=>{console.log("Lambda function invoked with event:",e);let t=process.env.TABLE_NAME,r=process.env.USER_POOL_ID,n=process.env.USER_POOL_CLIENT_ID;if(!t||!r||!n)return console.error("Environment variables are not set!"),{statusCode:500,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Internal Server Error: Environment variables not configured."})};let{httpMethod:i,path:o,body:a,requestContext:y}=e,d=y?.authorizer?.claims?.sub,_=y?.authorizer?.claims?.email;try{if(o==="/hello"&&i==="GET")return{statusCode:200,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Hello from your backend Lambda!",input:e,tableName:t})};if(o==="/auth/signup"&&i==="POST"){let{email:u,password:p}=JSON.parse(a),c={ClientId:n,Username:u,Password:p,UserAttributes:[{Name:"email",Value:u}]};return await se.send(new m.SignUpCommand(c)),{statusCode:200,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"User signed up successfully. Please confirm your email."})}}else if(o==="/auth/login"&&i==="POST"){let{email:u,password:p}=JSON.parse(a),c={AuthFlow:m.AuthFlowType.USER_PASSWORD_AUTH,ClientId:n,AuthParameters:{USERNAME:u,PASSWORD:p}},x=await se.send(new m.InitiateAuthCommand(c));return{statusCode:200,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Authentication successful",authenticationResult:x.AuthenticationResult})}}else if(o==="/auth/logout"&&i==="POST"){let u=e.headers?.Authorization?.split(" ")[1];return u?(await se.send(new m.GlobalSignOutCommand({AccessToken:u})),{statusCode:200,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"User logged out successfully."})}):{statusCode:400,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Access Token required for logout."})}}if(["POST","PUT","DELETE"].includes(i)&&!d)return{statusCode:401,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Unauthorized: Authentication required."})};if(o==="/posts"&&i==="POST"){let u=JSON.parse(a),p=(0,Ee.v4)(),{title:c,content:x}=u;if(!c||!x)return{statusCode:400,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Title and content are required."})};let N={TableName:t,Item:{postId:p,title:c,content:x,authorId:d,authorEmail:_,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}};return await v.send(new g.PutCommand(N)),{statusCode:201,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Post created successfully!",post:N.Item})}}else if(o==="/posts"&&i==="GET"){let u={TableName:t},{Items:p}=await v.send(new g.ScanCommand(u));return{statusCode:200,headers:{"Content-Type":"application/json"},body:JSON.stringify({posts:p})}}else if(o.startsWith("/posts/")&&i==="GET"){let u=o.split("/").pop(),p={TableName:t,Key:{postId:u}},{Item:c}=await v.send(new g.GetCommand(p));return c?{statusCode:200,headers:{"Content-Type":"application/json"},body:JSON.stringify({post:c})}:{statusCode:404,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Post not found."})}}else if(o.startsWith("/posts/")&&i==="PUT"){let u=o.split("/").pop(),p=JSON.parse(a),{title:c,content:x}=p,N={TableName:t,Key:{postId:u}},{Item:ae}=await v.send(new g.GetCommand(N));if(!ae)return{statusCode:404,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Post not found for update."})};if(ae.authorId!==d)return{statusCode:403,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Forbidden: You are not the author of this post."})};let M="set updatedAt = :updatedAt",J={":updatedAt":new Date().toISOString()};c&&(M+=", title = :title",J[":title"]=c),x&&(M+=", content = :content",J[":content"]=x);let Re={TableName:t,Key:{postId:u},UpdateExpression:M,ExpressionAttributeValues:J,ReturnValues:R.ReturnValue.ALL_NEW},{Attributes:Me}=await v.send(new g.UpdateCommand(Re));return{statusCode:200,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Post updated successfully!",post:Me})}}else if(o.startsWith("/posts/")&&i==="DELETE"){let u=o.split("/").pop(),p={TableName:t,Key:{postId:u}},{Item:c}=await v.send(new g.GetCommand(p));if(!c)return{statusCode:404,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Post not found for deletion."})};if(c.authorId!==d)return{statusCode:403,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Forbidden: You are not the author of this post."})};let x={TableName:t,Key:{postId:u}};return await v.send(new g.DeleteCommand(x)),{statusCode:200,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Post deleted successfully!"})}}return{statusCode:404,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Not Found"})}}catch(u){return console.error("Error processing request:",u),u.name==="UserNotFoundException"||u.name==="NotAuthorizedException"?{statusCode:400,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:u.message})}:{statusCode:500,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Internal Server Error",error:u.message})}}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
